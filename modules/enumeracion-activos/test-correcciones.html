<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Correcciones - Enumeración de Activos</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link href="../../assets/css/global.css" rel="stylesheet">
    <link href="../../assets/css/module.css" rel="stylesheet">
    <link href="module-styles.css" rel="stylesheet">
    <link href="icon-fix.css" rel="stylesheet">
    
    <style>
        .test-card {
            margin: 1rem 0;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .status-success { color: #28a745; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
        .status-warning { color: #ffc107; font-weight: bold; }
        .console-output {
            background: #000;
            color: #00ff00;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-8">
                <h1 class="mb-4">
                    <i class="fas fa-cog text-primary"></i>
                    Test de Correcciones - Enumeración de Activos
                </h1>
                
                <!-- Test 1: Sistema de Inicialización -->
                <div class="test-card">
                    <h3><i class="fas fa-rocket"></i> 1. Sistema de Inicialización</h3>
                    <div id="init-status">
                        <p><i class="fas fa-spinner fa-spin"></i> Inicializando sistemas...</p>
                    </div>
                </div>
                
                <!-- Test 2: Sistemas de Iconos -->
                <div class="test-card">
                    <h3><i class="fas fa-icons"></i> 2. Sistemas de Iconos</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <h5>IconFixSystem</h5>
                            <div id="icon-fix-status">Verificando...</div>
                        </div>
                        <div class="col-md-6">
                            <h5>SvgInlineInjector</h5>
                            <div id="svg-injector-status">Verificando...</div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-6">
                            <h5>SimpleIconLoader</h5>
                            <div id="simple-loader-status">Verificando...</div>
                        </div>
                        <div class="col-md-6">
                            <h5>IconDiagnostics</h5>
                            <div id="diagnostics-status">Verificando...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Test 3: Sistema de Diagramas -->
                <div class="test-card">
                    <h3><i class="fas fa-project-diagram"></i> 3. Sistema de Diagramas</h3>
                    <div id="diagram-status">Verificando...</div>
                    
                    <div class="mt-3">
                        <h5>Test de Diagramas Disponibles:</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <small>methodology-diagram:</small>
                                <svg id="test-diagram-1" data-diagram="methodology-diagram" style="width: 100%; height: 100px; border: 1px solid #ccc;">
                                    <use href="../../assets/images/diagrams.svg#methodology-diagram"></use>
                                </svg>
                            </div>
                            <div class="col-md-6">
                                <small>tools-comparison:</small>
                                <svg id="test-diagram-2" data-diagram="tools-comparison" style="width: 100%; height: 100px; border: 1px solid #ccc;">
                                    <use href="../../assets/images/diagrams.svg#tools-comparison"></use>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Test 4: Funciones Corregidas -->
                <div class="test-card">
                    <h3><i class="fas fa-wrench"></i> 4. Funciones Corregidas</h3>
                    <button class="btn btn-primary me-2" onclick="testFixAllIcons()">
                        <i class="fas fa-play"></i> Test fixAllIcons()
                    </button>
                    <button class="btn btn-secondary me-2" onclick="testSystemFixes()">
                        <i class="fas fa-tools"></i> Test System Fixes
                    </button>
                    <button class="btn btn-success" onclick="testFallbackSystems()">
                        <i class="fas fa-life-ring"></i> Test Fallbacks
                    </button>
                    <div id="function-test-results" class="mt-3"></div>
                </div>
            </div>
            
            <div class="col-md-4">
                <!-- Console Output -->
                <div class="test-card">
                    <h3><i class="fas fa-terminal"></i> Console Output</h3>
                    <div id="console-output" class="console-output">
                        Esperando logs del sistema...
                    </div>
                    <button class="btn btn-sm btn-outline-secondary mt-2" onclick="clearConsole()">
                        <i class="fas fa-trash"></i> Limpiar
                    </button>
                </div>
                
                <!-- System Status -->
                <div class="test-card">
                    <h3><i class="fas fa-heartbeat"></i> Estado del Sistema</h3>
                    <div id="system-status">
                        <div class="mb-2">
                            <strong>FontAwesome:</strong> <span id="fa-status">Verificando...</span>
                        </div>
                        <div class="mb-2">
                            <strong>Bootstrap:</strong> <span id="bootstrap-status">Verificando...</span>
                        </div>
                        <div class="mb-2">
                            <strong>SVG Diagrams:</strong> <span id="svg-file-status">Verificando...</span>
                        </div>
                        <div class="mb-2">
                            <strong>Module JS:</strong> <span id="module-status">Verificando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Icon Systems -->
    <script src="svg-inline-injector.js"></script>
    <script src="icon-fix.js"></script>
    <script src="simple-icon-loader.js"></script>
    <script src="icon-diagnostics.js"></script>
    
    <!-- Module Script -->
    <script src="module.js"></script>
    
    <script>
        // Console capture
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error
        };
        
        const consoleOutput = document.getElementById('console-output');
        let logs = [];
        
        function captureConsole() {
            ['log', 'warn', 'error'].forEach(method => {
                console[method] = function(...args) {
                    const timestamp = new Date().toLocaleTimeString();
                    const message = args.join(' ');
                    const logEntry = `[${timestamp}] ${method.toUpperCase()}: ${message}`;
                    
                    logs.push(logEntry);
                    if (logs.length > 50) logs.shift(); // Keep last 50 logs
                    
                    consoleOutput.innerHTML = logs.join('\n');
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                    
                    // Call original method
                    originalConsole[method].apply(console, args);
                };
            });
        }
        
        function clearConsole() {
            logs = [];
            consoleOutput.innerHTML = 'Console cleared...';
        }
        
        // Test functions
        function testFixAllIcons() {
            const results = document.getElementById('function-test-results');
            
            try {
                if (window.IconFixSystem && typeof window.IconFixSystem.fixAllIcons === 'function') {
                    window.IconFixSystem.fixAllIcons();
                    results.innerHTML = '<div class="alert alert-success">✅ fixAllIcons() ejecutado correctamente</div>';
                } else {
                    results.innerHTML = '<div class="alert alert-warning">⚠️ IconFixSystem.fixAllIcons no disponible</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        }
        
        function testSystemFixes() {
            const results = document.getElementById('function-test-results');
            
            try {
                if (typeof applySystemFixes === 'function') {
                    applySystemFixes();
                    results.innerHTML = '<div class="alert alert-success">✅ applySystemFixes() ejecutado correctamente</div>';
                } else {
                    results.innerHTML = '<div class="alert alert-warning">⚠️ applySystemFixes no disponible</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        }
        
        function testFallbackSystems() {
            const results = document.getElementById('function-test-results');
            
            try {
                if (typeof applyFallbackSystems === 'function') {
                    applyFallbackSystems();
                    results.innerHTML = '<div class="alert alert-success">✅ applyFallbackSystems() ejecutado correctamente</div>';
                } else {
                    results.innerHTML = '<div class="alert alert-warning">⚠️ applyFallbackSystems no disponible</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="alert alert-danger">❌ Error: ${error.message}</div>`;
            }
        }
        
        // Main test execution
        async function runTests() {
            captureConsole();
            console.log('🧪 Iniciando tests de correcciones...');
            
            // Wait for initialization
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Test 1: Initialization
            updateInitStatus();
            
            // Test 2: Icon Systems
            updateIconSystemsStatus();
            
            // Test 3: Diagram System
            updateDiagramStatus();
            
            // Test 4: System Status
            updateSystemStatus();
            
            console.log('✅ Tests completados');
        }
        
        function updateInitStatus() {
            const status = document.getElementById('init-status');
            const systems = ['IconFixSystem', 'SvgInlineInjector', 'SimpleIconLoader', 'IconDiagnostics'];
            const available = systems.filter(name => window[name]).length;
            
            status.innerHTML = `
                <p class="status-success">✅ Sistemas disponibles: ${available}/${systems.length}</p>
                <p>EnumeracionActivosModule: ${window.EnumeracionActivosModule ? '✅ Disponible' : '❌ No disponible'}</p>
            `;
        }
        
        function updateIconSystemsStatus() {
            document.getElementById('icon-fix-status').innerHTML = 
                window.IconFixSystem ? '<span class="status-success">✅ Disponible</span>' : '<span class="status-error">❌ No disponible</span>';
            
            document.getElementById('svg-injector-status').innerHTML = 
                window.SvgInlineInjector ? '<span class="status-success">✅ Disponible</span>' : '<span class="status-error">❌ No disponible</span>';
                
            document.getElementById('simple-loader-status').innerHTML = 
                window.SimpleIconLoader ? '<span class="status-success">✅ Disponible</span>' : '<span class="status-error">❌ No disponible</span>';
                
            document.getElementById('diagnostics-status').innerHTML = 
                window.IconDiagnostics ? '<span class="status-success">✅ Disponible</span>' : '<span class="status-error">❌ No disponible</span>';
        }
        
        function updateDiagramStatus() {
            const status = document.getElementById('diagram-status');
            const universalSystem = typeof UNIVERSAL_DIAGRAM_SYSTEM !== 'undefined';
            
            status.innerHTML = universalSystem ? 
                '<span class="status-success">✅ UNIVERSAL_DIAGRAM_SYSTEM disponible</span>' : 
                '<span class="status-error">❌ UNIVERSAL_DIAGRAM_SYSTEM no disponible</span>';
        }
        
        async function updateSystemStatus() {
            // FontAwesome check
            const faIcon = document.createElement('i');
            faIcon.className = 'fas fa-test';
            document.body.appendChild(faIcon);
            const faLoaded = getComputedStyle(faIcon).fontFamily.includes('Font Awesome');
            document.body.removeChild(faIcon);
            document.getElementById('fa-status').innerHTML = faLoaded ? 
                '<span class="status-success">✅ Cargado</span>' : '<span class="status-error">❌ No cargado</span>';
            
            // Bootstrap check
            document.getElementById('bootstrap-status').innerHTML = 
                typeof bootstrap !== 'undefined' ? '<span class="status-success">✅ Cargado</span>' : '<span class="status-error">❌ No cargado</span>';
                
            // SVG file check
            try {
                const response = await fetch('../../assets/images/diagrams.svg');
                document.getElementById('svg-file-status').innerHTML = response.ok ? 
                    '<span class="status-success">✅ Disponible</span>' : '<span class="status-error">❌ No disponible</span>';
            } catch {
                document.getElementById('svg-file-status').innerHTML = '<span class="status-error">❌ Error</span>';
            }
            
            // Module check
            document.getElementById('module-status').innerHTML = 
                typeof UNIVERSAL_DIAGRAM_SYSTEM !== 'undefined' ? '<span class="status-success">✅ Cargado</span>' : '<span class="status-error">❌ No cargado</span>';
        }
        
        // Auto-start tests
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            runTests();
        }
    </script>
</body>
</html>
